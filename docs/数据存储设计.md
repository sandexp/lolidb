
LoliDB主要存储在外存磁盘上. 支持Cache 到主存/高速缓存的功能.

1. 外部存储访问加速

+ 主存缓冲区

+ 多磁盘的使用与调度管理

    磁盘故障(容灾)

+ 预取数据(双缓冲区)


2. 磁盘数据的组织方式

+ 定长记录的存储方式

+ 非定长记录的存储方式

由于LoliDB按照传统型关系数据库进行处理, 所以主要采用定长记录的方式进行组织


3. 定长记录存储格式
<img src="img\定长记录存储格式.png" style="zoom:50%;" />


记录首部主要需要表示:
+ 记录存储修改时间
+ 记录是否可用
+ 记录长度信息
+ 记录的字段schema信息
+ 工作模式信息

4. 管理记录在磁盘上的位置

由于大多数情况下,记录是存储在磁盘上的, 所以需要特意的设置一个管理者, 去管理磁盘上记录的位置.

为了提升IO速率, 以便情况下以数据块的形式存储到磁盘上.

所以需要维护 数据块首地址. 将记录的指针位置记录在数据块中. 数据块换入主存中的时候, 去检索记录的起始位置.
终点位置参考记录首部信息.

此外, 数据块需要标明存储修改的时间信息(时间戳).

5. 中断调页机制
数据块会频繁的在主存和磁盘中调入调出.
需要实现数据块的中断调页机制,采取LRU的策略.


6. 大文件BLOB的存储
如果存储图片和图像视频内容的时候, 需要考虑到其存储会分配到多个柱面上的可能性.
这里先解决BLOB连续存储的问题,再考虑多磁盘分开存储的问题. 一般情况下多次盘分开存储速率较快.

大文件BLOB一般情况下会跨数据块存储. 所以考虑到这一点数据块 需要有他的前驱后继关系. 用于处理跨数据块问题.

这里的前驱后继主要指的是数据块标识符(位置),或者是说磁盘位置指针. 通常情况下会使用多线程的
方式去读取多个数据块. 因此对其进行组装就是必要的.

7. 数据的增删改查
删除: 为了不改变存储结构,尽量不用物理删除记录. 直接标识删除标记即可.

修改: 先查找此条记录,加载到内存中. 修改之后回写到磁盘中.

新增: 首先如果当前块中有空间存储就插入到当前块中,如果没有则插入到相邻的数据块中.

